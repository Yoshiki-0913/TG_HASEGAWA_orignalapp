<!-- product_list.html -->
{% extends 'base.html' %}
{% load static %}
{% block title %}商品一覧{% endblock %}

{% block stylesheet %}
<link href="{% static 'css/product_list.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<h2>商品一覧</h2>

<div class="search-bar">
    <form method="get">
        <select name="category">
            <option value="">カテゴリ選択</option>
            {% for category in categories %}
                <option value="{{ category.id }}">{{ category.category_name }}</option>
            {% endfor %}
        </select>
        <input type="text" name="search" placeholder="商品検索" value="{{ request.GET.search }}">
        <button type="submit">検索</button>
    </form>
</div>

<div class="product-grid">
    {% for product in products %}
    <div class="product-card" data-product-id="{{ product.id }}">
      {% if product.product_image %}
      <img src="{{ product.product_image.url }}" alt="{{ product.product_name }}">
  {% else %}
      <img src="{% static 'images/no_image.png' %}" alt="画像なし">  <!-- デフォルト画像 -->
  {% endif %}
  <div class ="product-name" >{{ product.product_name }}</div>
  <div class="quantity-controller">
      <button class="btn-minus" type="button" id = "decrease" onclick="decreaseQuantity('quantity-{{ forloop.counter }}')">−</button>
      <input id="quantity-{{ forloop.counter }}" class="quantity-input" type="text" value="0" readonly>
      <button class="btn-plus" type="button" id = "increase" onclick="increaseQuantity('quantity-{{ forloop.counter }}')">＋</button>
  </div>
        <div class="product-price" data-price="{{ product.unit_price|floatformat:0 }}">{{ product.unit_price|floatformat:0 }}円</div>
    </div>
    {% empty %}
    <p>商品が見つかりません。</p>
    {% endfor %}
</div>

<!-- ページネーション -->
<div class="pagination">
    {% if products.has_previous or products.has_next %}
        {% if products.has_previous %}
            <a href="?page={{ products.previous_page_number }}">&laquo; 前へ</a>
        {% endif %}

        {% for num in products.paginator.page_range %}
            {% if products.number == num %}
                <span class="current">{{ num }}</span>
            {% else %}
                <a href="?page={{ num }}">{{ num }}</a>
            {% endif %}
        {% endfor %}

        {% if products.has_next %}
            <a href="?page={{ products.next_page_number }}">次へ &raquo;</a>
        {% endif %}
    {% endif %}
</div>
<div>
    <p>合計金額: <span id="total-price">0</span>円</p>
</div>

<div class="settlement-bar">
    <form id="settlement-form" method="post" action="{% url 'confirm' %}">
        {% csrf_token %}
        <select id="settlement-method" name="settlement">
            <option value="">決済方法を選択</option>
            {% for method, method_name in payment_methods %}
                <option value="{{ method }}">{{ method_name }}</option>
            {% endfor %}
        </select>
        <button type="button" id="settlement-submit">購入確認へ</button>
    </form>
</div>
<div>
    <p>現在のページ: {{ products.number }}</p>
    <p>総ページ数: {{ products.paginator.num_pages }}</p>
    <p>総アイテム数: {{ products.paginator.count }}</p>
</div>
<div>
    <p>has_previous: {{ products.has_previous }}</p>
    <p>has_next: {{ object_list.has_next }}</p>
</div>
{% endblock %} 
